<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>Formulario Reparaciones</title>

    <style>
        /* 
           Este CSS solo ajusta el ancho del input "number" (Antigüedad).
           No tiene nada que ver con la lógica del examen, es solo estética.
        */
        input[type=number] {
            width: 60px;
        }
    </style>
</head>

<body>

    <h1>Solicitud de Reparación</h1>

    <!-- 
    FORMULARIO PRINCIPAL
    - Tiene un id="formReparacion" para poder capturarlo desde JavaScript.
    - El atributo action='#' significa que no lo estamos enviando a ninguna página real.
    - Podría ser action="procesar.php" en un proyecto real.
-->
    <form id="formReparacion">

        <!-- =========================
         BLOQUE: DATOS PERSONALES
         ========================= -->

        <!-- 
        input type="text" → caja de texto normal.
        id="apellidos" → JS podrá buscar este elemento con getElementById("apellidos").
        required → el navegador OBLIGA a que NO esté vacío para poder enviar el formulario.
    -->
        <label>Apellidos:</label>
        <input type="text" id="apellidos" required>

        <label>Nombre:</label>
        <input type="text" id="nombre" required>
        <br><br>

        <!-- 
        Teléfono y nº de serie también son obligatorios.
        required hace la validación básica sin JS.
        EJEMPLO:
          - Si pulsas Enviar sin rellenar teléfono, el navegador muestra un mensaje
            tipo "Rellene este campo".
    -->
        <label>Teléfono:</label>
        <input type="text" id="telefono" required>

        <label>Nº Serie:</label>
        <input type="text" id="numSerie" required>
        <br><br>

        <!-- =========================
         BLOQUE: TIPO DE REPARACIÓN
         ========================= -->

        <!-- 
        Los input type="radio" comparten el mismo name="tipo".
        Eso hace que solo se pueda seleccionar UNO a la vez.
        required en UNO de ellos obliga a que haya algún tipo marcado.
        EJEMPLO:
          - Si no marcas ninguno y pulsas Enviar, el navegador obliga a elegir uno.
    -->
        <label>Tipo de reparación:</label>
        <input type="radio" name="tipo" value="sobremesa" required> Sobremesa
        <input type="radio" name="tipo" value="portatil"> Portátil
        <input type="radio" name="tipo" value="impresora"> Impresora
        <br><br>

        <!-- 
        Este <div> empieza vacío.
        Si el usuario elige "Portátil", desde JavaScript se insertan aquí
        dos inputs: Marca y Modelo.
        Así cumplimos el apartado:
          "c) ... modifiquemos el DOM para que aparezcan Marca y Modelo".
    -->
        <div id="zonaPortatil"></div>

        <!-- =========================
         BLOQUE: ANTIGÜEDAD
         ========================= -->

        <!-- 
        input type="number" → solo acepta números.
        NO está required, así que se puede dejar vacío.
    -->
        <label>Antigüedad:</label>
        <input type="number" id="antiguedad">
        <br><br>

        <!-- =========================
         BLOQUE: SÍNTOMAS (CHECKBOX)
         ========================= -->

        <!-- 
        Cada checkbox tiene:
          - type="checkbox" → se pueden marcar varios.
          - class="sintoma" → los capturamos TODOS juntos en JS con querySelectorAll(".sintoma").
          - value="..." → es el texto que mostraremos luego por consola.
        Importante:
          En el enunciado piden "al menos 1 síntoma marcado" → esto NO se puede hacer solo con required.
          Por eso lo haremos con JavaScript.
    -->
        <label>Síntomas:</label><br>
        <input type="checkbox" class="sintoma" value="No hace nada"> No hace nada <br>
        <input type="checkbox" class="sintoma" value="Pita y no enciende"> Pita y no enciende <br>
        <input type="checkbox" class="sintoma" value="Se apaga solo"> Se apaga solo <br>
        <input type="checkbox" class="sintoma" value="No arranca SO"> No arranca SO <br>
        <br>

        <!-- =========================
         BLOQUE: OBSERVACIONES (TEXTAREA)
         ========================= -->

        <!-- 
        <textarea> → área de texto grande.
        - id="observaciones" → lo usaremos en JS.
        - En el apartado b) nos piden:
            "Controlar que al hacer clic sobre el área de texto permita escribir texto blanco
             sobre fondo negro."
          Esto se hace con JS cambiando style.backgroundColor y style.color.
    -->
        <label>Observaciones:</label><br>
        <textarea id="observaciones" rows="5" cols="50">
Escribe aquí cualquier cosa importante...
    </textarea>
        <br><br>

        <!-- =========================
         BLOQUE: USUARIO Y CONTRASEÑA
         ========================= -->

        <!-- Usuario solo tiene required: -->
        <label>Usuario:</label>
        <input type="text" id="usuario" required><br><br>

        <!-- 
        Contraseña:
        - type="password" → oculta los caracteres.
        - required → no se puede dejar en blanco.
        - pattern="_[0-9]{3}[A-Z][a-z]_"
            Esto define un PATRÓN que debe cumplir la contraseña:
            * Empieza con "_"        → el primer carácter es _
            * [0-9]{3}              → exactamente 3 dígitos (ej: 123)
            * [A-Z]                 → una letra mayúscula (ej: A)
            * [a-z]                 → una letra minúscula (ej: b)
            * "_"                   → termina con _
          EJEMPLOS VÁLIDOS:
            _123Ab_
            _999Zx_
          EJEMPLOS NO VÁLIDOS:
            123Ab_  (no empieza por "_")
            _12Ab_  (solo 2 números, faltan 3)
            _123AB_ (la segunda letra no es minúscula)
        - title="Formato: _123Ab_" → texto de ayuda que muestra el navegador si no coincide el patrón.
    -->
        <label>Contraseña:</label>
        <input type="password" id="password" required pattern="_[0-9]{3}[A-Z][a-z]_" title="Formato: _123Ab_">

        <br><br>

        <!-- Botones clásicos de formulario -->
        <input type="submit" value="Enviar">
        <input type="reset" value="Limpiar">

    </form>

    <!-- ==========================================
     A PARTIR DE AQUÍ: JAVASCRIPT DEL EJERCICIO
     ========================================== -->
    <script>

        document.addEventListener("DOMContentLoaded", function () {
        /* 
           CAPTURAMOS LOS ELEMENTOS IMPORTANTES DEL HTML
           (esto se suele hacer al principio del script).
        */

        // Capturamos el formulario completo
        const form = document.getElementById("formReparacion");

        // Div donde se añadirán los campos Marca y Modelo si eligen "portátil"
        const zonaPortatil = document.getElementById("zonaPortatil");

        // NodeList (como un array) con TODOS los checkbox que tengan class="sintoma"
        const sintomas = document.querySelectorAll(".sintoma");

        // Textarea de observaciones
        const observaciones = document.getElementById("observaciones");

        // =============================================
        // a) FUNCIÓN: MOSTRAR EN CONSOLA SÍNTOMAS MARCADOS
        // =============================================
        /*
           Recorremos todos los checkbox de síntomas y mostramos por consola
           solo aquellos que estén "checked" (marcados).
           Esto responde al apartado:
             "a) Crear una función javascript que muestre por consola los síntomas
              de avería que están seleccionados..."
        */
        function mostrarSintomas() {
            // Limpiamos la consola para que no se mezclen mensajes antiguos
            console.clear();
            alert("Síntomas seleccionados:");

            // forEach recorre cada elemento de "sintomas"
            sintomas.forEach(function (s) {
                // s.checked es true si el checkbox está marcado
                if (s.checked) {
                    // s.value es el valor definido en el HTML (ej: "No hace nada")
                    alert(s.value);
                }
            });

            /*
               EJEMPLO:
               - El usuario marca:
                 [x] No hace nada
                 [x] Se apaga solo
        
               - Al enviar el formulario, por consola se verá:
                 Síntomas seleccionados:
                 No hace nada
                 Se apaga solo
            */
        }

        // =============================================
        // b) TEXTAREA: FONDO NEGRO Y TEXTO BLANCO AL HACER FOCUS
        // =============================================
        /*
           Al hacer focus (pinchar dentro) en el textarea de observaciones,
           queremos que cambie a "modo oscuro":
           - Fondo negro
           - Texto blanco
        */
        observaciones.addEventListener("focus", function () {
            observaciones.style.backgroundColor = "black"; // cambiamos el fondo
            observaciones.style.color = "white";           // cambiamos el color del texto

            /*
               EJEMPLO VISUAL:
               Antes: fondo blanco, texto negro.
               Después de hacer clic:
               - fondo → negro
               - texto → blanco
            */
        });

        // =============================================
        // c) CAMPOS EXTRA SI EL TIPO ES "PORTÁTIL"
        // =============================================
        /*
           Necesitamos saber CUÁNDO cambia el tipo de reparación.
           Buscamos TODOS los radios con name="tipo".
        */
        document.querySelectorAll("input[name='tipo']").forEach(function (radio) {

            // A cada radio le añadimos un "listener" para el evento "change"
            radio.addEventListener("change", function () {

                /*
                   this.value es el valor del radio que ha cambiado.
                   Si su value es "portatil", añadimos al DOM (dentro de zonaPortatil)
                   dos inputs: Marca y Modelo.
                */
                if (this.value === "portatil") {
                    zonaPortatil.innerHTML =
                        `Marca: <input type="text" id="marca" required>
                 Modelo: <input type="text" id="modelo" required><br><br>`;

                    /*
                       Fíjate que también ponemos required en estos inputs.
                       Eso significa que, si el usuario ha elegido portátil,
                       estará obligado a rellenar la marca y el modelo.
        
                       EJEMPLO:
                       - Selecciona "Portátil".
                       - JavaScript inyecta:
                           Marca: [  ]
                           Modelo: [  ]
                       - Si intenta enviar sin rellenarlos, el navegador mostrará
                         el aviso de "Rellene este campo".
                    */

                } else {
                    /*
                       Si el usuario cambia a "Sobremesa" o "Impresora",
                       borramos el contenido de zonaPortatil.
        
                       De esta forma, Marca y Modelo solo aparecen
                       cuando el tipo es "portátil".
                    */
                    zonaPortatil.innerHTML = "";
                }
            });
        });

        // =============================================
        // d) VALIDAR QUE HAYA AL MENOS UN SÍNTOMA MARCADO
        // =============================================
        /*
           Esto NO se puede hacer solo con HTML5, por eso usamos JS.
        
           Lógica:
           - Cuando el usuario intenta enviar el formulario (evento "submit")
           - Comprobamos si al menos uno de los checkbox de síntomas está marcado.
           - Si NO hay ninguno marcado:
               → cancelamos el envío con e.preventDefault()
               → mostramos un alert() con el mensaje de error.
           - Si SÍ hay alguno:
               → dejamos que el navegador siga con sus validaciones (required, pattern, etc.)
               → mostramos los síntomas en la consola (apartado a).
        */
        form.addEventListener("submit", function (e) {

            // Array.from() convierte el NodeList "sintomas" en un array normal
            // some() devuelve true si ALGUNO cumple la condición (está marcado)
            const haySintomaMarcado = Array.from(sintomas).some(function (s) {
                return s.checked; // true si el checkbox está marcado
            });

            if (!haySintomaMarcado) {
                // Bloqueamos el envío del formulario
                e.preventDefault();

                // Mostramos mensaje al usuario
                alert("Debes marcar al menos un síntoma.");

                /*
                   EJEMPLO:
                     - Usuario rellena todo pero no marca ningún síntoma.
                     - Al pulsar Enviar:
                         → NO se envía
                         → Muestra alerta: "Debes marcar al menos un síntoma."
                */
                return; // salimos de la función, no seguimos
            }

            // Si hay al menos un síntoma marcado:
            // llamamos a la función del apartado (a) para mostrar los síntomas en consola.
            mostrarSintomas();

            /*
               Ojo:
               - DESPUÉS de esta función, el navegador todavía comprueba:
                   * required de los campos de texto
                   * pattern de la contraseña
                   * required del radio "tipo"
               - Si alguna de esas validaciones HTML5 falla, también bloqueará el envío.
            */
        });
    });
    </script>

</body>

</html>